<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <title>商赢集团</title>
    <link rel="stylesheet" href="./css/common.css" />
	<link rel="stylesheet" href="./css/swiper.3.0.css" />
	<link rel="stylesheet" href="./css/animate.css" />
	<style>
		.swiper-container {
			width: 100%;
			height: 100%;
		}
		.swiper-container.jobs-page {
			margin-top: 20%;
		}
		.custom-page {
			position: absolute;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
		}
		.translate-out-x {
			transform: translate3d(-100%,0,0);
		}
		.card-jobs {
			position: relative;
			width: 100%;
			height: 100%;
			background: #ccc;
			overflow: hidden;
		}
		.swiper-container.jobs-page {
			width: 100%;
			height: 70%;
			-webkit-perspective: 1200px;
			perspective: 1200px;	
		}
		.card-slide {
			width: 80%;
			-webkit-transform-style: preserve-3d;
			-moz-transform-style: preserve-3d;
			-ms-transform-style: preserve-3d;
			transform-style: preserve-3d;
		}
		.card-slide .card{
			width: 100%;
			height: 100%;
			overflow: hidden;
			margin: 0 auto;
			background: #fff;
		}


		/**********************************demo*************************/
		.page1 {
			background: #ccc;
			z-index: 3;
		}
		.page2 {
			background: blue;
			z-index: 2;
		}
		.page3 {
			z-index: 1;
		}
	</style>
</head>
<body>
    <div class="swiper-container" id="main-page">
		<div class="swiper-wrapper">
			<div class="swiper-slide">
				page1
			</div>
			<div class="swiper-slide main-slide">
				<div class="custom-page page1">
					<button id="changeJobs">集团</button>
					<button>电商</button>
					<button>金服</button>
				</div>
				<div class="custom-page page2">
					<ul>
						<li class="jobItem">职位一</li>
						<li class="jobItem">职位二</li>
						<li class="jobItem">职位三</li>
					</ul>
				</div>
				<div class="custom-page page3 translate-out-x">
					<div class="card-jobs">
						<div class="swiper-container jobs-page" id="jobs-page">
							<div class="swiper-wrapper jobs-wrapper">
								<div class="swiper-slide card-slide">
									<div class="card">111</div>
								</div>
								<div class="swiper-slide card-slide">
									<div class="card">222</div>
								</div>
								<div class="swiper-slide card-slide">
									<div class="card">333</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="swiper-slide main-slide">
				<button id="backFirstPage">返回首页</button>
			</div>
		</div>
	</div>
	<script src="./js/zepto.min.js"></script>
	<script src="./js/swiper.min.js"></script>
	<script>

		var jobsAttr = {
			jobPagesState: 0
		};

		var mainSwiper = {
			domName: '#main-page',
			direction:	'vertical',
			swiper: null,
			newSwiper: function() {
				this.swiper = new Swiper(this.domName, {
					direction: this.direction,
					onSlideChangeStart: this.onSlideChangeStart
				});
				return this;
			},
			onSlideChangeStart: function(swiper) {
				if(swiper.activeIndex == 1 && jobsAttr.jobPagesState != 3) {
					jobsAttr.jobPagesState = 1;
					swiper.disableTouchControl();
				}
			},
			jumpSildeTo: function(index) {
				this.swiper.slideTo(index, 0 ,false);
			}	
		};

		var jobsSwiper = {
			domName: '#jobs-page',
			swiper: null,
			newSwiper: function() {
				this.swiper = new Swiper(this.domName, {
					centeredSlides: true,
					watchSlidesProgress: true,
					slidesPerView: 'auto',
					spaceBetween: 40,
					onSlideChangeStart: this.onSlideChangeStart,
					onSetTransition: this.onSetTransition,
					onProgress: this.onProgress
				});
				return this;
			},
			onProgress: function(swiper) {
				var i, slide, progress;
				for (i = 0; i < swiper.slides.length; i++) {
					slide = swiper.slides[i];
					progress = slide.progress;
					slide.style.opacity = 1 - Math.min(Math.abs(progress / 2), 1);
					slide.style.webkitTransform = slide.style.transform = "translate3d(0,0," + -Math.abs(150 * progress) + "px)";
				}
			},
			onSetTransition: function(swiper, transition) {
				var slide;
				for (var i = 0; i < swiper.slides.length; i++){
					slide = swiper.slides[i].style;
					slide.webkitTransitionDuration = slide.transitionDuration = transition + "ms";
				}
			},
			jumpSildeTo: function(index) {
				this.swiper.slideTo(index, 0 ,false);
			}	
		};

		$(function() {

			var windowHeight = document.documentElement.clientHeight,
				windowWidth = document.documentElement.clientWidth,
				mainSlides = $(".main-slide");
				mainSlides.css('height', windowHeight);

			mainSwiper.newSwiper();
			jobsSwiper.newSwiper();


			$("#changeJobs").click(function() {
				$(".page1").addClass('animated fadeOut');
				$(".page2").addClass('animated fadeInUp');
				setTimeout(function() {
					$(".page1").hide();
				}, 1000);
				jobsAttr.jobPagesState = 2;
			});

			$(".jobItem").click(function() {
				$(".page2").removeClass('fadeInUp').addClass('animated fadeOutLeft');
				$(".page3").removeClass('translate-out-x').addClass("animated fadeInRight");
				jobsAttr.jobPagesState = 3;
				var index = $(this).index();
				jobsSwiper.jumpSildeTo(index);
				mainSwiper.swiper.enableTouchControl();
			});

			$("#backFirstPage").on('click', function() {
				mainSwiper.jumpSildeTo(0)
			});

		});


	</script>
</body>
</html>